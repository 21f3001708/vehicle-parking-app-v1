{% extends 'base.html' %}
{% block title %}User Dashboard{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: auto; padding: 2em;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>User Dashboard</h1>
        <a href="{{ url_for('parking_history') }}" style="margin-right: 1em;">View History</a>
        <a href="{{ url_for('logout') }}">Logout</a>
    </div>
    
    <p>Welcome, {{ current_user.full_name }}!</p>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert-{{ category }}" style="padding: 1em; margin-bottom: 1em; border-radius: 5px; background-color: #d4edda;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <hr>

    {% if active_reservation %}
        <h2>Your Active Parking Spot</h2>
        <div style="border: 1px solid #007bff; padding: 1.5em; border-radius: 5px;">
            <p><strong>Lot Name:</strong> {{ active_reservation.spot.lot.name }}</p>
            <p><strong>Spot Number:</strong> #{{ active_reservation.spot.spot_number }}</p>
            <p><strong>Parked At:</strong> {{ active_reservation.start_time.strftime('%Y-%m-%d %H:%M:%S') }}</p>
            <form method="POST" action="{{ url_for('release_spot') }}">
                <input type="hidden" name="reservation_id" value="{{ active_reservation.id }}">
                <button type="submit" style="background-color: #dc3545;">Release Spot</button>
            </form>
        </div>

    {% else %}
        <h2>Available Parking Lots</h2>
        <table border="1" style="width: 100%; border-collapse: collapse; margin-top: 1em;">
            <thead>
                <tr>
                    <th>Lot Name</th>
                    <th>Price/Hour</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for lot in lots %}
                <tr>
                    <td>{{ lot.name }}</td>
                    <td>${{ "%.2f"|format(lot.price_per_hour) }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('book_spot') }}">
                            <input type="hidden" name="lot_id" value="{{ lot.id }}">
                            <button type="submit">Book a Spot</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}

</div>
{% endblock %}